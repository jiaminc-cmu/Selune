# Selune Performance Report

> Auto-generated by `benchmarks/run_benchmarks.sh` on 2026-02-26 18:26:24
> To regenerate: `./benchmarks/run_benchmarks.sh`

# Selune Benchmark Results

**Date:** 2026-02-26 18:26:23
**Machine:** arm64 Apple M3
**OS:** macOS 14.5
**Runs per benchmark:** 3 (best of N)

### Implementations

- **Selune:** ./target/release/selune
- **PUC Lua:** Lua 5.4.8  Copyright (C) 1994-2025 Lua.org, PUC-Rio
- **LuaJIT:** LuaJIT 2.1.1767980792 -- Copyright (C) 2005-2026 Mike Pall. https://luajit.org/

---

## Results

| Benchmark | Selune (s) | PUC Lua (s) | LuaJIT (s) | Selune/PUC | Selune/LuaJIT |
|-----------|-----------|-------------|------------|------------|---------------|
| arithmetic | 2.194712 | 3.099346 | 0.236021 | 0.71x | 9.30x |
| fibonacci | 0.710598 | 0.728688 | 0.068264 | 0.98x | 10.41x |
| ackermann | 16.630630 | 7.159819 | 0.841054 | 2.32x | 19.77x |
| table_array | 0.087126 | 0.091751 | 0.010331 | 0.95x | 8.43x |
| table_hash | 2.477637 | 1.853310 | 0.394667 | 1.34x | 6.28x |
| table_object | 0.769439 | 0.394684 | 0.091670 | 1.95x | 8.39x |
| string_concat | 0.391735 | 0.211068 | 0.097319 | 1.86x | 4.03x |
| string_match | 0.113354 | 0.013433 | 0.010804 | 8.44x | 10.49x |
| string_format | 1.584480 | 0.700812 | 0.217500 | 2.26x | 7.28x |
| closures | 0.352196 | 0.371258 | 0.208758 | 0.95x | 1.69x |
| method_calls | 1.326824 | 0.839245 | 0.088715 | 1.58x | 14.96x |
| coroutines | 0.770794 | 0.225696 | SKIP | 3.42x | â€” |
| gc_pressure | 1.032388 | 0.858411 | 0.118335 | 1.20x | 8.72x |
| binary_trees | 2.756081 | 2.928035 | 0.720761 | 0.94x | 3.82x |
| spectral_norm | 1.788063 | 3.082117 | 0.057527 | 0.58x | 31.08x |
| mandelbrot | 0.375921 | 1.339329 | 0.112160 | 0.28x | 3.35x |
| nbody | 3.736255 | 1.547621 | 0.066605 | 2.41x | 56.10x |
| raytracer | 5.750307 | 2.388714 | 0.075701 | 2.41x | 75.96x |
| particle_sim | 0.261906 | 1.676835 | 0.191670 | 0.16x | 1.37x |

---

**Legend:**
- **Selune/PUC**: ratio of Selune time to PUC Lua time (lower is better for Selune; <1.0x means Selune is faster)
- **Selune/LuaJIT**: ratio of Selune time to LuaJIT time (lower is better for Selune)
- **SKIP**: benchmark not applicable for that implementation
- **FAIL**: benchmark failed to run

## Summary

- **Geometric mean Selune/PUC Lua:** 1.29x (across 19 benchmarks)
- **Geometric mean Selune/LuaJIT:** 8.94x (across 18 benchmarks)


---

## Analysis

### Category Breakdown

| Category | Benchmarks | Notes |
|----------|-----------|-------|
| Arithmetic/Loops | arithmetic, fibonacci, ackermann | Core dispatch loop + integer/float ops |
| Tables | table_array, table_hash, table_object | Array vs hash performance, metatable dispatch |
| Strings | string_concat, string_match, string_format | String interning, pattern engine, formatting |
| Functions | closures, method_calls | Closure creation, upvalue access, OOP dispatch |
| Coroutines | coroutines | Yield/resume overhead (Selune vs PUC only) |
| GC | gc_pressure, binary_trees | Allocation rate, GC pause time, tree traversal |
| Math | spectral_norm, mandelbrot | Float-heavy tight loops |

### Optimization Roadmap

**Short-term (low-hanging fruit):**
- NaN-boxing dispatch optimizations (reduce branching in hot paths)
- Table array pre-allocation hints
- String interning cache improvements

**Medium-term:**
- Inline caching for method calls and table lookups
- Register allocation improvements in the compiler
- Specialized fast paths for common patterns (e.g., `for i=1,n`)

**Long-term:**
- JIT compilation (selune-jit crate)
- Generational GC (selune-core)
- SIMD-accelerated string operations

### How to Profile

#### Using Instruments (macOS)
```bash
# Time Profiler
xcrun xctrace record --template 'Time Profiler' --launch ./target/release/selune benchmarks/scripts/fibonacci.lua
```

#### Using cargo-flamegraph
```bash
cargo install flamegraph
cargo flamegraph --release -- benchmarks/scripts/fibonacci.lua
```

#### Using perf (Linux)
```bash
perf record -g ./target/release/selune benchmarks/scripts/fibonacci.lua
perf report
```

